<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡§ú‡§Ø ‡§Æ‡§π‡§æ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞ ‡§≤‡•Ä‡§ó ‚Äì BGMI Tournament</title>
  <style>
    /* Your previous CSS remains unchanged */
    body { font-family: Arial, sans-serif; background: url('https://i.ibb.co/0pbYtPPz/PUBG-BGMI-BACKGROUND-FOR-THUMBNAIL.jpg') no-repeat center center fixed; background-size: cover; color: #fff; margin: 0; padding: 0; }
    header { display: flex; justify-content: space-between; align-items: center; background: rgba(34,34,34,0.9); padding: 20px; border-bottom: 2px solid #ff9800; }
    header h1 { color: #ff9800; margin: 0; display: flex; align-items: center; gap: 10px; }
    header h1 img { width: 50px; height: 50px; }
    header a { background: #ff9800; padding: 10px 15px; border-radius: 6px; text-decoration: none; color: #fff; font-weight: bold; }
    section { background: rgba(0,0,0,0.7); border-radius: 12px; padding: 20px; max-width: 650px; margin: 20px auto; }
    section h2, section h3 { text-align: center; color: #ffcc00; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    .row input { flex: 1; }
    input, button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: none; font-size: 14px; }
    input[type="file"] { background: #333; color: #fff; }
    button { background: #ff9800; color: #fff; font-weight: bold; cursor: pointer; }
    button:disabled { background: #777; cursor: not-allowed; }
    #successMessage { display: none; text-align: center; margin-top: 15px; padding: 10px; border-radius: 6px; background: #4caf50; font-weight: bold; }
    #qrSection, #paymentSection { display: none; text-align: center; margin-top: 20px; }
    #qrSection img { width: 200px; border: 3px solid #ff9800; border-radius: 12px; }
    #helpConnect { margin-top: 20px; text-align: center; }
    #helpConnect button { width: auto; margin: 5px; padding: 10px 20px; }
    #connectCard { display: none; margin-top: 10px; padding: 10px; border-radius: 8px; background: #ff9800; color: #111; font-weight: bold; }
    .terms { margin-top: 15px; text-align: left; font-size: 14px; }
    .terms label { display: flex; align-items: center; gap: 8px; }
  </style>
</head>
<body>
  <header>
    <h1>
      <img src="https://i.ibb.co/NkBNyzr/logo.png" alt="Tournament Logo">
      ‡§ú‡§Ø ‡§Æ‡§π‡§æ‡§∞‡§æ‡§∑‡•ç‡§ü‡•ç‡§∞ ‡§≤‡•Ä‡§ó ‚Äì BGMI Tournament
    </h1>
    <a href="rulebook.pdf" target="_blank">üìï Rulebook</a>
  </header>

  <section id="formSection"></section>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz6z4SUeVBSMzTOIw2CNYfcgPf_MRvDKHEq153SuPuZv4ZoStcMjujADCjcgI19tUD6/exec";
    const section = document.getElementById("formSection");

    const form = document.createElement("form");
    form.id = "registrationForm";
    form.enctype = "multipart/form-data";

    form.innerHTML = `
      <h2>‡§ü‡•Ä‡§Æ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®</h2>
      <input type="text" id="team_name" placeholder="‡§ü‡•Ä‡§Æ‡§ö‡•á ‡§®‡§æ‡§µ" required />
      <input type="text" id="captain_name" placeholder="‡§ï‡•Ö‡§™‡•ç‡§ü‡§®‡§ö‡•á ‡§®‡§æ‡§µ" required />

      <label>Team Logo (PNG/JPG)</label>
      <input type="file" id="team_logo" accept=".png, .jpg, .jpeg" required />

      <h3>Players Details</h3>
      <div class="row">
        <input type="text" id="player1_ign" placeholder="Player 1 In-Game Name" required />
        <input type="text" id="player1_id" placeholder="Player 1 Number ID" required />
      </div>
      <div class="row">
        <input type="text" id="player2_ign" placeholder="Player 2 In-Game Name" required />
        <input type="text" id="player2_id" placeholder="Player 2 Number ID" required />
      </div>
      <div class="row">
        <input type="text" id="player3_ign" placeholder="Player 3 In-Game Name" required />
        <input type="text" id="player3_id" placeholder="Player 3 Number ID" required />
      </div>
      <div class="row">
        <input type="text" id="player4_ign" placeholder="Player 4 In-Game Name" required />
        <input type="text" id="player4_id" placeholder="Player 4 Number ID" required />
      </div>
      <div class="row">
        <input type="text" id="player5_ign" placeholder="Player 5 In-Game Name (Substitute)" />
        <input type="text" id="player5_id" placeholder="Player 5 Number ID (Substitute)" />
      </div>

      <div class="row">
        <input type="email" id="email" placeholder="‡§à‡§Æ‡•á‡§≤" required />
        <input type="tel" id="phone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞" required />
      </div>

      <div class="terms">
        <label>
          <input type="checkbox" id="agreeTerms" required />
          ‡§Æ‡•Ä ‡§®‡§ø‡§Ø‡§Æ ‡§µ ‡§Ö‡§ü‡•Ä ‡§µ‡§æ‡§ö‡§≤‡•ç‡§Ø‡§æ ‡§Ü‡§π‡•á‡§§ ‡§µ ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ï‡§∞‡§§‡•ã. (<a href="rulebook.pdf" target="_blank">Rulebook</a>)
        </label>
      </div>

      <button type="submit" id="registerBtn">Proceed to Payment</button>
    `;

    const qrSection = document.createElement("div");
    qrSection.id = "qrSection";
    qrSection.innerHTML = `
      <h3>üì≤ Scan to Pay</h3>
      <img src="https://i.ibb.co/KxFJ0g0J/qr-code-png.png" alt="Payment QR Code" />
      <p>‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§∞‡•Ç‡§® ‡§™‡•Å‡§¢‡•á Screenshot ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ.</p>
    `;

    const paymentSection = document.createElement("div");
    paymentSection.id = "paymentSection";
    paymentSection.innerHTML = `
      <label>Upload Payment Screenshot (PNG/JPG)</label>
      <input type="file" id="payment_ss" accept=".png, .jpg, .jpeg" required />
      <button id="finalSubmit">Submit Registration</button>
    `;

    const successMessage = document.createElement("div");
    successMessage.id = "successMessage";
    successMessage.innerText = "‚úÖ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ü‡•Ä‡§Æ ‡§®‡•ã‡§Ç‡§¶ ‡§ù‡§æ‡§≤‡•Ä ‡§Ü‡§π‡•á.";

    const helpConnect = document.createElement("div");
    helpConnect.id = "helpConnect";
    helpConnect.innerHTML = `
      <button id="helpBtn">Help</button>
      <button id="connectBtn">Connect Us</button>
      <div id="connectCard">
        üìû Contact 1: 7517043667<br>
        üìû Contact 2: 8261901691
      </div>
    `;

    section.appendChild(form);
    section.appendChild(qrSection);
    section.appendChild(paymentSection);
    section.appendChild(successMessage);
    section.appendChild(helpConnect);

    // Step 1: Show QR and Payment
    form.addEventListener("submit", async function(e) {
      e.preventDefault();

      const logo = document.getElementById("team_logo").files[0];
      if (!logo || !["image/png","image/jpeg"].includes(logo.type)){
        alert("‚ùå ‡§ü‡•Ä‡§Æ ‡§≤‡•ã‡§ó‡•ã ‡§´‡§ï‡•ç‡§§ PNG ‡§ï‡§ø‡§Ç‡§µ‡§æ JPG ‡§Ö‡§∏‡§æ‡§µ‡§æ!");
        return;
      }
      if(!document.getElementById("agreeTerms").checked){
        alert("‚ùå ‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§ø‡§Ø‡§Æ ‡§µ ‡§Ö‡§ü‡•Ä ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§ï‡§∞‡§æ!");
        return;
      }
      form.style.display="none";
      qrSection.style.display="block";
      paymentSection.style.display="block";
    });

    // Step 2: Upload all data to Google Sheets
    document.getElementById("finalSubmit").addEventListener("click", async function(e){
      e.preventDefault();

      const paymentFile = document.getElementById("payment_ss").files[0];
      if(!paymentFile || !["image/png","image/jpeg"].includes(paymentFile.type)){
        alert("‚ùå ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§®‡§∂‡•â‡§ü ‡§´‡§ï‡•ç‡§§ PNG ‡§ï‡§ø‡§Ç‡§µ‡§æ JPG ‡§Ö‡§∏‡§æ‡§µ‡§æ!");
        return;
      }

      // Convert images to Base64
      const toBase64 = file => new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = ()=>resolve(reader.result);
        reader.onerror = error=>reject(error);
      });

      const teamLogoBase64 = await toBase64(document.getElementById("team_logo").files[0]);
      const paymentBase64 = await toBase64(paymentFile);

      // Prepare data
      const payload = {
        team_name: document.getElementById("team_name").value,
        captain_name: document.getElementById("captain_name").value,
        player1_ign: document.getElementById("player1_ign").value,
        player1_id: document.getElementById("player1_id").value,
        player2_ign: document.getElementById("player2_ign").value,
        player2_id: document.getElementById("player2_id").value,
        player3_ign: document.getElementById("player3_ign").value,
        player3_id: document.getElementById("player3_id").value,
        player4_ign: document.getElementById("player4_ign").value,
        player4_id: document.getElementById("player4_id").value,
        player5_ign: document.getElementById("player5_ign").value,
        player5_id: document.getElementById("player5_id").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        team_logo: teamLogoBase64,
        payment_ss: paymentBase64
      };

      // Send to Google Apps Script
      fetch(WEB_APP_URL, {
        method: "POST",
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data=>{
        if(data.status==="success"){
          successMessage.style.display="block";
          qrSection.style.display="none";
          paymentSection.style.display="none";
        }else{
          alert("‚ùå Error: "+data.message);
        }
      })
      .catch(err=>{
        alert("‚ùå Submission failed! "+err);
      });
    });

    document.getElementById("helpBtn").addEventListener("click", function(){
      window.open("help.pdf","_blank");
    });

    document.getElementById("connectBtn").addEventListener("click", function(){
      const card = document.getElementById("connectCard");
      card.style.display = card.style.display === "none" ? "block" : "none";
    });

  </script>
</body>
</html>